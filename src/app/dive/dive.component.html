<main class="page container page-form-dive">
  <mat-card>
      <form  class="register-form inscription" [formGroup]="diveForm">
        <section class="time">
            <mat-toolbar>
              <span>DATE ET HEURE </span>
            </mat-toolbar>
            <div class="row text-center">
              <div class="col-md-3">
                <mat-form-field class="full-width">
                  <input matInput [matDatepicker]="dp" placeholder="Date de plongée" formControlName="divingDate">
                  <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
                  <mat-datepicker #dp></mat-datepicker>
                </mat-form-field>
              </div>
              <div class="col-md-6">
                <div formArrayName="times" class="well well-lg">
                  <div class="boat" *ngFor="let time of times.controls; let i=index" [formGroupName]="i" >
                    <div class="button-row text-right" *ngIf="times.length > 1">
                      <button mat-mini-fab color="warn" (click)="removeTime(i)">X</button>
                    </div>
                    <ul class="list-inline">
                      <li class="list-inline-item">
                        <mat-form-field class="full-width">
                          <input matInput placeholder="Heure de début" value="00:00" formControlName="startTime">
                        </mat-form-field>
                        <div *ngIf="time.controls.startTime.invalid && (time.controls.startTime.dirty || time.controls.startTime.touched)" class="alert alert-danger">
                          <div *ngIf="time.controls.startTime.errors.required">
                            Le nom de bateau est obligatoire.
                          </div>
                        </div>
                      </li>
                      <li class="list-inline-item">
                        <mat-form-field class="full-width">
                          <input matInput placeholder="Heure de fin" value="00:00" formControlName="endTime">
                        </mat-form-field>
                        <div *ngIf="time.controls.endTime.invalid && (boat.controls.endTime.dirty || time.controls.endTime.touched)" class="alert alert-danger">
                          <div *ngIf="time.controls.endTime.errors.required">
                            L'imatriculation de bateau est obligatoire.
                          </div>
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>
                <div class="col-md-12 text-center">
                  <div class="button-row">
                    <a mat-mini-fab (click)="addTime()">+</a>
                  </div>
                </div>
              </div>
          </div>
        </section>
        <section class="structure">
          <h6>Avez-vous plongé en structure ? *</h6>
          <mat-radio-group formControlName="isWithStructure">
            <mat-radio-button value="true">Oui</mat-radio-button>
            <mat-radio-button value="false">Non</mat-radio-button>
          </mat-radio-group>
          <mat-error *ngIf="hasSubmit && diveForm.get('isWithStructure').invalid">Ce champs est obligatoire</mat-error>
          <div class="col-md-12" *ngIf="isWithStructure.value == 'true'">
            <h5>Selectionner une structure *</h5>
            <mat-form-field>
              <mat-select formControlName="structure">
                <mat-option *ngFor="let user of users" [value]="user">
                  {{ user.firstname }} {{ user.lastname }}
                </mat-option>
              </mat-select>
              <mat-error>Ce champs est obligatoire</mat-error>
            </mat-form-field>
          </div>
        </section>
        <section class="boats container-fluid" *ngIf="isWithStructure.value == 'false' && boats.length">
          <h4 class="title row">BATEAUX</h4>
          <!-- <div *ngIf="boatsChsd.length > 0">
            <h5>BATEAUX DECLARES</h5>
            <mat-chip-list>
              <mat-chip *ngFor="let bt of boatsChsd;let i=index">{{bt.boat}}
                <button mat-icon-button>
                  <mat-icon class="material-icons md-18"  color="warn" (click)="deleteBoat(i)">clear</mat-icon>
                </button>
              </mat-chip>
            </mat-chip-list>
          </div> -->
          <mat-form-field>
            <mat-select [formControl]="boatCtrl" multiple>
              <mat-select-trigger>
                {{boatCtrl.value ? boatCtrl.value[0].name : ''}}
                <span *ngIf="boatCtrl.value?.length > 1">
                  (+{{boatCtrl.value.length - 1}})
                </span>
              </mat-select-trigger>
              <mat-option *ngFor="let boat of boats" [value]="boat">
                Nom: {{ boat.name }} |
                <small>Immatriculation: {{boat.matriculation}}</small>
              </mat-option>
            </mat-select>
          </mat-form-field>
        </section>
        <section class="weather">
          <mat-toolbar>
            <span>CONDITION CLIMATIQUES </span>
          </mat-toolbar>
          <div [ngClass]="{'has-error': hasSubmit && diveForm.get('wind').invalid}">
            <h5 class="title with-required">VENT(km/h)</h5>
            <mat-slider
              class="full-width"
              [invert]="false"
              [max]="20"
              [min]="1"
              [step]="true"
              formControlName="wind"
              [vertical]="false">
            </mat-slider>
          </div>
          <div [ngClass]="{'has-error': hasSubmit && diveForm.get('sky').invalid}">
            <h5 class="title with-required">CIEL</h5>
            <ul class="list-inline weather">
            <mat-radio-group class="wather-radio no-radio" formControlName="sky">
              <mat-radio-button class="example-radio-button" value='weather_soleil'>
                <li *ngIf="sky.value != 'weather_soleil' " class="list-inline-item"><img src="./assets/icons/f_weather_soleil.svg" /></li>
                <li *ngIf="sky.value == 'weather_soleil' " class="list-inline-item"><img src="./assets/icons/weather_soleil-on.svg" /></li>
              </mat-radio-button>
              <mat-radio-button class="wather-radio" value='weather_nuage'>
                <li *ngIf="sky.value != 'weather_nuage' " class="list-inline-item"><img src="./assets/icons/f_weather_nuage.svg" /></li>
                <li *ngIf="sky.value == 'weather_nuage' " class="list-inline-item"><img src="./assets/icons/weather_nuage-on.svg" /></li>
              </mat-radio-button>
              <mat-radio-button class="wather-radio" value='weather_pluie'>
                <li *ngIf="sky.value != 'weather_pluie' " class="list-inline-item"><img src="./assets/icons/f_weather_pluie.svg" /></li>
                <li *ngIf="sky.value == 'weather_pluie' " class="list-inline-item"><img src="./assets/icons/weather_pluie-on.svg" /></li>
              </mat-radio-button>
              <mat-radio-button class="wather-radio" value='weather_orage'>
                <li *ngIf="sky.value != 'weather_orage' " class="list-inline-item"><img src="./assets/icons/f_weather_orage.svg" /></li>
                <li *ngIf="sky.value == 'weather_orage' " class="list-inline-item"><img src="./assets/icons/weather_orage-on.svg" /></li>
              </mat-radio-button>
            </mat-radio-group>
            </ul>
          </div>
          <div [ngClass]="{'has-error': hasSubmit && diveForm.get('seaState').invalid}">
              <h5 class="title with-required">ETAT DE LA MER</h5>
              <ul class="list-inline weather">
            <mat-radio-group class="example-radio-group no-radio" formControlName="seaState">
              <mat-radio-button class="wather-radio" value='weather_calme'>
                <li *ngIf="seaState.value != 'weather_calme' " class="list-inline-item"><img src="./assets/icons/f_weather_calme.svg" /></li>
                <li *ngIf="seaState.value == 'weather_calme' " class="list-inline-item"><img src="./assets/icons/weather_calme-on.svg" /></li>
              </mat-radio-button>
              <mat-radio-button class="wather-radio" value='weather_mouvemente'>
                <li *ngIf="seaState.value != 'weather_mouvemente' " class="list-inline-item"><img src="./assets/icons/f_weather_mouvemente.svg" /></li>
                <li *ngIf="seaState.value == 'weather_mouvemente' " class="list-inline-item"><img src="./assets/icons/weather_mouvemente-on.svg" /></li>
              </mat-radio-button>
              <mat-radio-button class="wather-radio" value='weather_agite'>
                <li *ngIf="seaState.value != 'weather_agite' " class="list-inline-item"><img src="./assets/icons/f_weather_agite.svg" /></li>
                <li *ngIf="seaState.value == 'weather_agite' " class="list-inline-item"><img src="./assets/icons/weather_agite-on.svg" /></li>
              </mat-radio-button>
              <mat-radio-button class="wather-radio" value='weather_tempete'>
                <li *ngIf="seaState.value != 'weather_tempete' " class="list-inline-item"><img src="./assets/icons/f_weather_tempete.svg" /></li>
                <li *ngIf="seaState.value == 'weather_tempete' " class="list-inline-item"><img src="./assets/icons/weather_tempete-on.svg" /></li>
              </mat-radio-button>
            </mat-radio-group>
            </ul>
          </div>
          <div class="row">
            <div [ngClass]="{'col-md-4': true, 'has-error': hasSubmit && diveForm.get('wind_temperature').invalid}">
              <h5 class="title with-required">Température de l'air</h5>
              <mat-form-field class="full-width">
                <input matInput value="0" formControlName="wind_temperature">
              </mat-form-field>
            </div>
            <div [ngClass]="{'col-md-4': true, 'has-error': hasSubmit && diveForm.get('wind_temperature').invalid}">
              <h5 class="title with-required">Température de l'eau</h5>
              <mat-form-field class="full-width">
                <input matInput value="0" formControlName="water_temperature">
              </mat-form-field>
            </div>
            <div [ngClass]="{'col-md-4': true, 'form-group-visibility': true, 'has-error': hasSubmit && diveForm.get('wind_temperature').invalid}">
              <!-- <input matInput placeholder="visiblité" value="0" formControlName="visibility"> -->
              <h5 class="title with-required">Visiblité</h5>
              <mat-radio-group formControlName="visibility">
                <mat-radio-button value="0">0 à 5</mat-radio-button>
                <mat-radio-button value="5">5 à 15</mat-radio-button>
                <mat-radio-button value="15">>15</mat-radio-button>
              </mat-radio-group>
            </div>
          </div>
        </section>
        <section class="typedives">
          <mat-toolbar>
            <span>TYPE DE PLONGÉE </span>
          </mat-toolbar>
            <div formArrayName="divetypes" class="well well-lg">
              <div class="boat">
                <ul class="list-inline">
                <li class="list-inline-item" *ngFor="let typedive of divetypes.controls; let i=index" [formGroupName]="i" >
                  <mat-checkbox class="example-margin" formControlName="name">{{diveTypes[i].name}}</mat-checkbox>
                  <mat-form-field class="full-width" *ngIf="divetypes.controls[i].controls.name.value">
                    <input matInput placeholder="Nombre de plongeur" formControlName="nbrDivers">
                  </mat-form-field>
                </li>
              </ul>
              </div>
            </div>
        </section>
        <section class="sitedives">
          <mat-toolbar>
            <span>SITE DE PLONGÉE </span>
          </mat-toolbar>
          <div>
            Cliquez sur la carte pour définir votre lieu de plongé.
          </div>
          <input matInput value="" formControlName="latlng">
          <!-- <div class="row">
            <div class="col-md-3">
              <mat-radio-group formControlName="referenced">
                <mat-radio-button value="referenced" class="ref-radio">Site réferencé</mat-radio-button>
                <mat-radio-button value="notreferenced" class="ref-radio">Site non réferencé</mat-radio-button>
              </mat-radio-group>
            </div>
            <div class="col-md-6">
              <input matInput placeholder="coordonnées de plongée (cliquer pour choisir vos coordonnées)" value="" formControlName="latlng">
            </div>
          </div> -->
          <div id="leafletmap" style="height: 400px;"
          leaflet
          [leafletOptions]="options"
          (leafletMapReady)="onMapReady($event)"
          >
        </div>
        <button class="btn btn-secondary btn-block" (click)="save()">ENVOYER LA DÉCLARATION</button>
      </section>
      </form>
  </mat-card>
</main>
